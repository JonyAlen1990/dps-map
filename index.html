<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –î–ü–°/–ì–ê–ò</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #1a2a6c; color: #fff; padding: 20px; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; padding: 25px; background: linear-gradient(90deg, #ff7e00, #ff0000); border-radius: 15px; margin-bottom: 20px; }
        h1 { font-size: 2.2rem; margin-bottom: 10px; }
        .map-container { height: 500px; border-radius: 15px; overflow: hidden; margin-bottom: 20px; background: #2a2a2a; position: relative; border: 3px solid #ff7e00; }
        #map { height: 100%; width: 100%; }
        .btn { padding: 15px 25px; border: none; border-radius: 10px; background: #ff7e00; color: white; margin: 10px; cursor: pointer; font-size: 16px; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; }
        .legend { background: #2d2d2d; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .legend-item { display: flex; align-items: center; margin: 10px 0; }
        .color-box { width: 20px; height: 20px; border-radius: 50%; margin-right: 15px; border: 2px solid white; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöì –ö–∞—Ä—Ç–∞ –î–ü–°/–ì–ê–ò</h1>
            <p>–û—Ç–º–µ—á–∞–π—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –î–ü–°/–ì–ê–ò –Ω–∞ –∫–∞—Ä—Ç–µ</p>
        </header>

        <div style="text-align: center; margin: 20px 0;">
            <button class="btn" onclick="addRandomMarkers()">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫–∏</button>
            <button class="btn" onclick="centerMap()">–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn" onclick="clearMarkers()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div class="legend">
            <h3>–õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã</h3>
            <div class="legend-item"><div class="color-box" style="background:#ff0000"></div><span>–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Å—Ç –î–ü–°</span></div>
            <div class="legend-item"><div class="color-box" style="background:#ff7e00"></div><span>–ü–∞—Ç—Ä—É–ª—å –î–ü–°</span></div>
            <div class="legend-item"><div class="color-box" style="background:#ffff00"></div><span>–°—Ç–∞—Ä–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span></div>
        </div>

        <div class="map-container">
            <div id="map">
                <div class="loading">
                    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</h3>
                    <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map;
        let markers = [];

        function initMap() {
            try {
                // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
                map = L.map('map').setView([55.7558, 37.6176], 13);
                
                // –î–æ–±–∞–≤–ª—è–µ–º tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap'
                }).addTo(map);
                
                // –°–∫—Ä—ã–≤–∞–µ–º loading
                document.querySelector('.loading').style.display = 'none';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
                map.on('click', function(e) {
                    if (confirm('–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É –î–ü–°?')) {
                        addMarker(e.latlng.lat, e.latlng.lng);
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –º–µ—Ç–∫–∏
                addTestMarkers();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.querySelector('.loading').innerHTML = '<h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã</h3><p>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>';
            }
        }

        function addMarker(lat, lng, type) {
            const colors = {
                'active': '#ff0000',
                'patrol': '#ff7e00', 
                'old': '#ffff00'
            };
            
            const icon = L.divIcon({
                html: <div style="background:${colors[type]}; width:24px;height:24px;border-radius:50%;border:3px solid white;"></div>,
                iconSize: [30, 30]
            });
            
            const marker = L.marker([lat, lng], {icon: icon}).addTo(map);
            markers.push(marker);
        }

        function addTestMarkers() {
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç–æ–∫ –≤–æ–∫—Ä—É–≥ –ú–æ—Å–∫–≤—ã
            addMarker(55.7558, 37.6176, 'active');
            addMarker(55.7517, 37.6178, 'patrol');
            addMarker(55.7490, 37.6220, 'old');
            addMarker(55.7600, 37.6250, 'active');
        }

        function addRandomMarkers() {
            clearMarkers();
            addTestMarkers();
        }

        function centerMap() {
            map.setView([55.7558, 37.6176], 13);
        }

        function clearMarkers() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            setTimeout(initMap, 100);
        };
    </script>
</body>
</html>
